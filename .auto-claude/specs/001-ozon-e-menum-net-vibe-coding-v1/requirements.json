{
  "task_description": "PROJE: e-menum.net — Hijyenik QR Menü SaaS (Next.js + Node.js + Supabase + Vercel)\nAMAÇ (TEK ÇEKİRDEK): Müşteri telefon kamerasıyla QR okutup online menüye erişsin. Diğer her şey tamamlayıcıdır.\n\nKULLANIM: Bu promptu “vibe coding” için yapıştır. Kod + doküman + test çıktısı üret. Emoji/ikon KULLANMA.\n\n-------------------------\n1) REFERANS DOSYALAR (HEPSİNİ MENTION’LA, ÇELİŞKİYİ ÇÖZ)\nRepo/docs referansları:\n@README.md , \n@menu.md , \n@chatgpt.md , \n@gemini.md , \n@gereksinimler.md , \n@paketler.md , \n@temel.md , \n@ek_ozellikler.md , \n@mimari.dev.dosya-adlandirma.md , \n@UI-UX-UED-CDN-kaynaklar.md , \n@additional_features.md , \n@gemini2.md , \n@gpt2.md , \n@last.md , \n@master2.md , \n@todos.md , \n---\nÇELİŞKİ ÇÖZÜM KURALI (SOURCE OF TRUTH):\n- Bu MASTER PROMPT > README.md > menu.md (route gerçekleri) > ek_ozellikler.md (modül/DB şeması) > chatgpt.md+gemini.md (gap/uyum uyarıları) > paketler.md+temel.md (pazarlama, çelişirse düzelt, 2 kere menu düzenleme sınırı, süper admin tarafından düzenlenebilir bir özellik olmalı.) > UI-UX... (kaynak listesi) > mimari... (isimlendirme rehberi)\n- gereksinimler.md: ERPNext/Frappe entegrasyonu BU PROJEDE YOK. Sadece “PIM benzeri kavram” olarak referans al; implementasyon tamamen Next.js/Node/Supabase.\n\n-------------------------\n2) STACK ve KISITLAR (HARD)\n- Tamamen Next.js (App Router) + Node.js ekosistemi\n- Hosting: Vercel (app) + Supabase (Postgres + Auth + Storage)\n- Multi-tenant zorunlu: Supabase RLS ile izolasyon (tenant filtresiz query YASAK)\n- Domain: e-menum.net (tüm iç linkler relative; domain bağımlı kod YASAK)\n- “Az kodla çok iş”: schema-driven UI, component registry, config/feature flags DB’den\n- SEO + hız: public menü sayfaları ISR/SSG + cache + revalidate (menü publish/snapshot ile)\n\n-------------------------\n3) NON-NEGOTIABLE ÜRÜN KURALLARI\nQR CORE\n- Merchant kayıt olur → restoran slug oluşur → QR otomatik üretilir ve her zaman erişilebilir.\n- QR formatları: SVG + PNG(1024/2048/4096) + A5 baskıya uygun PDF (pleksiglass için şık tasarım).\n- QR erişim noktaları:\n  - Dashboard: “QR Kodlarım” (indir/re-download)\n  - Dashboard: Restoran profil/cover alanı hızlı erişim\n  - Public menü cover’da (yalnız merchant login ise) indirebilme opsiyonu\n- QR link stabil olmalı:\n  - /menu/{restaurant_slug} (kanonik)\n  - Masa bazlı opsiyon: /menu/{slug}?table_id={code} (table context)\n- Menü güncellenince QR bozulmaz (same link, new published snapshot).\n\nUYUM + KANIT (Price Ledger + Snapshot/Hash)\n- Fiyatlar products içinde tutulmaz; insert-only price_ledger.\n- UPDATE/DELETE fiyat kayıtlarına YASAK (DB trigger ile engelle).\n- Publish anında menu snapshot JSON + SHA-256 hash üret, sakla, export edilebilir yap.\n\nPAKET/PLAN\n- Plan kontrolleri hard-coded YASAK. (if plan==X yok)\n- Planlar dinamik: Free/Lite/Gold/Platinum/Enterprise + yeni plan eklenebilir.\n- paketler.md/temel.md içindeki “Fiyat revize 2 defa” ve “Whatsapp üzerinden revize” DEPRECATED:\n  - Fiyat güncelleme her planda sınırsız (ledger mantığı).\n  - Limitlenecek şey: schedule event sayısı, retention süresi, export formatları, bulk işlemler, gelişmiş modüller vb.\n  - WhatsApp “revize kanalı” değil; sadece destek/notification opsiyonudur.\n\nDEFAULT DEV ADMIN\n- DEV ortamında default user=admin password=admin olabilir.\n- PROD’da kesin kapalı: ilk login şifre değişimi zorunlu + ENV guard + rate limit + audit.\n\n-------------------------\n4) ÇEKİRDEK SAYFALAR / ROUTES (menu.md KANONİK)\n- Public:\n  - / (awwwards-level landing)\n  - /features /pricing /templates /showcase /faq /blog(optional) /about /contact /legal/*\n  - /menu/[slug] (QR hedefi)\n  - /r/[slug] (restaurant landing opsiyonel)\n- Auth:\n  - /login /register /password-recovery /reset-password /verify-email /auth/callback\n- App (protected):\n  - /dashboard /products /categories /tables /waiter /audit /settings\n- Super Admin (protected, RBAC):\n  - /admin /admin/organizations /admin/plans /admin/overrides /admin/ai\n\nKural: listelenen tüm route’lar 200 dönmeli; “routing stabilizasyon” checklist’i şart.\n\n-------------------------\n5) MODÜLLER (MAX FEATURE, MODÜLER)\nA) Restaurant Profile + Public Restaurant Page\n- Profil: logo/cover/iletişim/şube/saatler\n- Menü sergileme, arama/filtre, alerjen/ingredients, çok dil\n- SEO: JSON-LD + OG + canonical + hreflang\n\nB) Menu Builder (DRAG-DROP) — KRİTİK\n- Basit: drag-drop + canlı preview + undo/redo + autosave\n- Component registry (extend edilebilir): hero, category sections, product cards/grid, banner, badges, bundles block, info blocks, CTA, etc.\n- Taxonomy tree (çok seviyeli): örn ızgaralar/kebaplar/urfa_kebabı\n- Draft/Publish ayrımı, publish → snapshot/hash → revalidate\n\nC) Product Management (PIM-benzeri, ERPNext’siz)\n- Ürün CRUD, varyantlar, modifier/extras, ingredients, allergens, nutrition(optional)\n- Bundle/Set menu (burger+patates+kola) destekli model\n- Import/Export: CSV+JSON\n\nD) Tables + Waiter Call (ek_ozellikler.md)\n- restaurant_tables\n- table-aware QR\n- waiter call realtime events\n\nE) Ordering (opsiyonel ama hazır mimari)\n- cart/checkout, order status, KDS/garson ekranı opsiyon\n\nF) Super Admin + Impersonation\n- Tenant aktivasyonu, plan/override, impersonate\n- Compliance export (snapshot+hash), retention yönetimi\n\nG) AI Token Store (opsiyonel add-on, superadmin yönetir)\n- Provider gateway: OpenAI + Gemini (secret keys sadece server-side, client’a asla gitmez)\n- SKU bazlı paket: “aylık 20 image”, “X token” gibi quota\n- Usage metering: token/image count + monthly cap + audit log\n- Pricing table ve add-on’lar dinamik yönetilir (hard-coded fiyat yok)\n\n-------------------------\n6) MINIMAL DB + IMPORT/EXPORT-FIRST (AZ SQL, ÇOK İŞ)\n- DB sadece çekirdek ve indekslenebilir veriyi tutar.\n- Builder/theme/layout “JSON config” olarak saklanır.\n- Seed SQL şişirme YASAK: kurulum = migrations + import package.\n- JSON import DB’yi upsert ile günceller (idempotent).\n- Export: CSV (products/categories/variants/modifiers) + JSON (builder/theme/menu snapshot manifest).\n\n-------------------------\n7) UX + GAMIFICATION (ZORUNLU)\n- Onboarding: tour builder + görev zinciri + progress + skip/resume\n- Gamification: setup quests, kalite skoru, ödül (template unlock / trial) — core akışı engellemez.\n- Accessibility: WCAG 2.1 AA hedefi (keyboard nav, focus, contrast, aria).\n- Theme module ayrı: dark/light switcher + tokens.\n- Okunabilirlik: yaşlı dostu font/kontrast (QR menü ana kullanım).\n\n-------------------------\n8) TEST KAPISI (ÇIKTI ZORUNLU)\nUnit:\n- RLS izolasyon testleri (tenant A/B)\n- price_ledger immutability (update/delete fail)\n- snapshot/hash doğrulama\n- feature flag enforcement\n- import idempotency\nIntegration/E2E:\n- auth flows\n- builder drag-drop + publish + rollback\n- public menu ISR/revalidate\nUsability:\n- “register → QR indir → publish” 10 dk altında hedef\nPerf/SEO:\n- Lighthouse hedefleri; LCP/CLS/INP bütçesi\n\n-------------------------\n9) VIBE CODING ÇIKTI FORMATI (NE ÜRETECEKSİN)\nHer iterasyonda:\n1) Kısa “plan + assumption + risk” (maks 10 madde)\n2) Kod değişiklikleri (dosya/diff mantığıyla)\n3) DB migrations + RLS policies + triggers\n4) routes.ts / docs route envanteri güncelle\n5) features.json + plans.json (dinamik plan/feature sistemi)\n6) Test ekle ve çalıştırılabilir hale getir\n7) Dokümanları patchle (çelişkiyi kaldır: paketler.md/temel.md)\n\n-------------------------\n10) EN ÖNEMLİ KURAL\nBu ürünün çekirdeği: “QR okut → menü aç” ve “kanıtlanabilir fiyat/memu geçmişi”.\nBunu zayıflatan her öneri RED.\n\n \n! ayrıca tüm sistemin sağlıklı çalışabilmesi için, ci/cd, kurulum, kullanım, yönergeleri içeren md uzantılı kurulum ve yönerge dosyaları oluştur.",
  "workflow_type": "feature"
}